# GitHub Actions åŒæ­¥æ›´æ–°æŠ¥å‘Š

## ğŸ“‹ æ›´æ–°æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°åŒæ­¥äº† GitHub Actions é…ç½®æ–‡ä»¶ï¼Œä»¥åæ˜ é¡¹ç›®é‡æ„åçš„æ–°å·¥ä½œæµç¨‹ã€‚

## ğŸ¯ æ›´æ–°èŒƒå›´

### 1. CI å·¥ä½œæµ (`.github/workflows/ci.yml`) âœ…

#### æ–°å¢æ­¥éª¤

**build-extension-linux ä»»åŠ¡:**
```yaml
- name: Generate config
  run: bash scripts/generate-key.sh
```

**ä½ç½®:** åœ¨ "Build extension" æ­¥éª¤ä¹‹å‰

**ä½œç”¨:** 
- è‡ªåŠ¨ç”ŸæˆåŠ å¯†å¯†é’¥é…ç½®
- åˆ›å»º `.php-guard/config.env` æ–‡ä»¶
- ä¾›åç»­æ„å»ºæ­¥éª¤ä½¿ç”¨

#### å˜æ›´è¯´æ˜

| ä»»åŠ¡ | å˜æ›´å†…å®¹ | åŸå›  |
|------|----------|------|
| test | æ— å˜æ›´ | ä¸éœ€è¦å¯†é’¥é…ç½® |
| build-cli | æ— å˜æ›´ | CLI å·¥å…·ä¸éœ€è¦å¯†é’¥é…ç½® |
| build-extension-linux | æ–°å¢ "Generate config" æ­¥éª¤ | æ‰©å±•æ„å»ºéœ€è¦å¯†é’¥é…ç½® |

### 2. Release å·¥ä½œæµ (`.github/workflows/release.yml`) âœ…

#### æ–°å¢æ­¥éª¤

**build-extension-linux ä»»åŠ¡:**
```yaml
- name: Generate config
  run: bash scripts/generate-key.sh
```

**ä½ç½®:** åœ¨ "Build extension" æ­¥éª¤ä¹‹å‰

#### æ‰“åŒ…å˜æ›´

**build-cli ä»»åŠ¡:**
```yaml
# å˜æ›´å‰
cp README.md LICENSE dist/

# å˜æ›´å
cp -r scripts dist/
cp README.md LICENSE dist/
```

**build-extension-linux ä»»åŠ¡:**
```yaml
# å˜æ›´å‰
cp README.md LICENSE dist/

# å˜æ›´å
cp -r scripts dist/
cp README.md LICENSE dist/
```

**ä½œç”¨:** 
- å°† `scripts/` ç›®å½•åŒ…å«åœ¨å‘å¸ƒåŒ…ä¸­
- ç”¨æˆ·å¯ä»¥ç›´æ¥ä½¿ç”¨ `generate-key.sh` è„šæœ¬

#### å‘å¸ƒè¯´æ˜æ›´æ–°

**å˜æ›´å‰:**
```markdown
### ä½¿ç”¨ CLI å·¥å…·

# åˆå§‹åŒ–é…ç½®
./php-guard init

# ç”Ÿæˆå¯†é’¥
./php-guard generate-key

# åŠ å¯†æ–‡ä»¶
./php-guard encrypt src/

# éªŒè¯é…ç½®
./php-guard verify
```

**å˜æ›´å:**
```markdown
### å®‰è£…æ­¥éª¤

**1. å®‰è£… PHP æ‰©å±•**
[å®‰è£…è¯´æ˜...]

**2. ç”Ÿæˆå¯†é’¥é…ç½®**
```bash
# è§£å‹ CLI å·¥å…·åŒ…ï¼ˆåŒ…å« scripts ç›®å½•ï¼‰
tar -xzf php-guard-linux-x64.tar.gz

# ç”ŸæˆåŠ å¯†å¯†é’¥
bash scripts/generate-key.sh
```

**3. é‡æ–°æ„å»ºæ‰©å±•ï¼ˆä½¿ç”¨æ‚¨çš„å¯†é’¥ï¼‰**
[æ„å»ºè¯´æ˜...]

**4. åŠ å¯† PHP æ–‡ä»¶**
```bash
./php-guard encrypt src/
```

### é‡è¦è¯´æ˜

âš ï¸ **å¯†é’¥é…ç½®**
- é¢„ç¼–è¯‘çš„æ‰©å±•ä½¿ç”¨éšæœºå¯†é’¥ï¼Œä»…ç”¨äºæµ‹è¯•
- ç”Ÿäº§ç¯å¢ƒè¯·åŠ¡å¿…ç”Ÿæˆè‡ªå·±çš„å¯†é’¥å¹¶é‡æ–°ç¼–è¯‘

### å¯ç”¨å‘½ä»¤

CLI å·¥å…·æ”¯æŒä»¥ä¸‹å‘½ä»¤ï¼š
- `./php-guard encrypt <path>` - åŠ å¯†æ–‡ä»¶æˆ–ç›®å½•
- `./php-guard check <path>` - æ£€æŸ¥åŠ å¯†çŠ¶æ€
```

## ğŸ“Š å˜æ›´å¯¹æ¯”

### å·¥ä½œæµç¨‹å¯¹æ¯”

**å˜æ›´å‰:**
```
CI/Release æµç¨‹:
1. Checkout
2. Install dependencies
3. Build extension (ä½¿ç”¨ç¡¬ç¼–ç å¯†é’¥)
4. Test
5. Package
```

**å˜æ›´å:**
```
CI/Release æµç¨‹:
1. Checkout
2. Install dependencies
3. Generate config (è¿è¡Œè„šæœ¬ç”Ÿæˆå¯†é’¥)
4. Build extension (ä½¿ç”¨ç”Ÿæˆçš„å¯†é’¥)
5. Test
6. Package (åŒ…å« scripts ç›®å½•)
```

### ç”¨æˆ·ä½“éªŒå¯¹æ¯”

**å˜æ›´å‰:**
1. ä¸‹è½½é¢„ç¼–è¯‘æ‰©å±•
2. å®‰è£…æ‰©å±•
3. ä¸‹è½½æºç 
4. æ‰‹åŠ¨ç”Ÿæˆå¯†é’¥
5. æ‰‹åŠ¨åŒæ­¥é…ç½®
6. é‡æ–°ç¼–è¯‘
7. ä½¿ç”¨ CLI å·¥å…·

**å˜æ›´å:**
1. ä¸‹è½½å‘å¸ƒåŒ…ï¼ˆåŒ…å«æ‰©å±•ã€CLIã€scriptsï¼‰
2. å®‰è£…æ‰©å±•ï¼ˆæµ‹è¯•ç”¨ï¼‰
3. è¿è¡Œ `scripts/generate-key.sh` ç”Ÿæˆé…ç½®
4. å¦‚éœ€ç”Ÿäº§ä½¿ç”¨ï¼Œä½¿ç”¨è„šæœ¬é‡æ–°æ„å»º
5. ä½¿ç”¨ CLI å·¥å…·åŠ å¯†æ–‡ä»¶

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### å¯†é’¥ç”Ÿæˆæ—¶æœº

| åœºæ™¯ | æ—¶æœº | é…ç½®ä½ç½® |
|------|------|----------|
| CI æµ‹è¯• | æ„å»ºå‰è‡ªåŠ¨ç”Ÿæˆ | `.php-guard/config.env` |
| Release æ„å»º | æ„å»ºå‰è‡ªåŠ¨ç”Ÿæˆ | `.php-guard/config.env` |
| ç”¨æˆ·ä½¿ç”¨ | ç”¨æˆ·æ‰‹åŠ¨è¿è¡Œè„šæœ¬ | `.php-guard/config.env` |

### é…ç½®æ–‡ä»¶å¤„ç†

**build.rs è¡Œä¸º:**
1. æ£€æŸ¥ `.php-guard/config.env` æ˜¯å¦å­˜åœ¨
2. å¦‚æœå­˜åœ¨ï¼Œè¯»å–é…ç½®
3. å¦‚æœä¸å­˜åœ¨ï¼Œç”Ÿæˆéšæœºé…ç½®
4. ç”Ÿæˆ Rust ä»£ç 

**CI/Release ä¸­:**
- è„šæœ¬æ€»æ˜¯ç”Ÿæˆæ–°é…ç½®
- æ¯æ¬¡æ„å»ºä½¿ç”¨ä¸åŒçš„éšæœºå¯†é’¥
- é¢„ç¼–è¯‘æ‰©å±•ä»…ç”¨äºæµ‹è¯•

### å‘å¸ƒåŒ…å†…å®¹

**å˜æ›´å‰:**
```
php-guard-linux-x64.tar.gz
â”œâ”€â”€ php-guard
â”œâ”€â”€ README.md
â””â”€â”€ LICENSE
```

**å˜æ›´å:**
```
php-guard-linux-x64.tar.gz
â”œâ”€â”€ php-guard
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ generate-key.sh
â”‚   â””â”€â”€ generate-key.bat
â”œâ”€â”€ README.md
â””â”€â”€ LICENSE
```

## âœ… éªŒè¯æ£€æŸ¥æ¸…å•

### CI å·¥ä½œæµ

- [x] test ä»»åŠ¡æ­£å¸¸è¿è¡Œï¼ˆä¸éœ€è¦å¯†é’¥ï¼‰
- [x] build-cli ä»»åŠ¡æ­£å¸¸è¿è¡Œï¼ˆä¸éœ€è¦å¯†é’¥ï¼‰
- [x] build-extension-linux ä»»åŠ¡æ·»åŠ å¯†é’¥ç”Ÿæˆæ­¥éª¤
- [x] æ‰©å±•æ„å»ºæˆåŠŸ
- [x] æ‰©å±•æµ‹è¯•é€šè¿‡

### Release å·¥ä½œæµ

- [x] build-cli ä»»åŠ¡åŒ…å« scripts ç›®å½•
- [x] build-extension-linux ä»»åŠ¡æ·»åŠ å¯†é’¥ç”Ÿæˆæ­¥éª¤
- [x] build-extension-linux ä»»åŠ¡åŒ…å« scripts ç›®å½•
- [x] å‘å¸ƒè¯´æ˜æ›´æ–°æ­£ç¡®
- [x] å¯ç”¨å‘½ä»¤åˆ—è¡¨æ­£ç¡®

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### CI ç¯å¢ƒä¸­çš„æ„å»º

```yaml
# è‡ªåŠ¨ç”Ÿæˆé…ç½®
- name: Generate config
  run: bash scripts/generate-key.sh

# æ„å»ºæ‰©å±•ï¼ˆä½¿ç”¨ç”Ÿæˆçš„é…ç½®ï¼‰
- name: Build extension
  run: cargo build --features php-extension --release
```

### ç”¨æˆ·ä½¿ç”¨æµç¨‹

```bash
# 1. ä¸‹è½½å‘å¸ƒåŒ…
wget https://github.com/.../php-guard-linux-x64.tar.gz
tar -xzf php-guard-linux-x64.tar.gz

# 2. ç”Ÿæˆå¯†é’¥
bash scripts/generate-key.sh

# 3. æŸ¥çœ‹é…ç½®
cat .php-guard/config.env

# 4. ä½¿ç”¨ CLI å·¥å…·
./php-guard encrypt src/
```

## ğŸ“ æ³¨æ„äº‹é¡¹

### é¢„ç¼–è¯‘æ‰©å±•çš„å¯†é’¥

âš ï¸ **é‡è¦æç¤º:**
- CI/Release ä¸­è‡ªåŠ¨ç”Ÿæˆçš„å¯†é’¥æ˜¯éšæœºçš„
- æ¯æ¬¡æ„å»ºä½¿ç”¨ä¸åŒçš„å¯†é’¥
- é¢„ç¼–è¯‘æ‰©å±•ä»…ç”¨äºæµ‹è¯•å…¼å®¹æ€§
- **ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨è‡ªå·±çš„å¯†é’¥é‡æ–°ç¼–è¯‘**

### é…ç½®æ–‡ä»¶å®‰å…¨

- `.php-guard/` ç›®å½•å·²æ·»åŠ åˆ° `.gitignore`
- å‘å¸ƒåŒ…ä¸åŒ…å«é…ç½®æ–‡ä»¶
- ç”¨æˆ·éœ€è¦è‡ªå·±ç”Ÿæˆé…ç½®

### è·¨å¹³å°å…¼å®¹æ€§

- Linux/macOS: ä½¿ç”¨ `bash scripts/generate-key.sh`
- Windows: ä½¿ç”¨ `scripts\generate-key.bat` æˆ– Git Bash

## ğŸ¯ æ”¹è¿›æ•ˆæœ

### è‡ªåŠ¨åŒ–ç¨‹åº¦

- **å˜æ›´å‰:** éœ€è¦æ‰‹åŠ¨ç®¡ç†é…ç½®
- **å˜æ›´å:** CI/CD è‡ªåŠ¨ç”Ÿæˆé…ç½®

### ç”¨æˆ·ä½“éªŒ

- **å˜æ›´å‰:** éœ€è¦é¢å¤–ä¸‹è½½è„šæœ¬
- **å˜æ›´å:** è„šæœ¬åŒ…å«åœ¨å‘å¸ƒåŒ…ä¸­

### æ–‡æ¡£æ¸…æ™°åº¦

- **å˜æ›´å‰:** ä½¿ç”¨è¯´æ˜åˆ†æ•£ï¼Œå‘½ä»¤è¿‡æ—¶
- **å˜æ›´å:** ç»Ÿä¸€çš„å®‰è£…æ­¥éª¤ï¼Œæ¸…æ™°çš„å‘½ä»¤è¯´æ˜

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®é‡æ„æŠ¥å‘Š](REFACTORING_REPORT.md) - è¯¦ç»†çš„é‡æ„è¯´æ˜
- [ä½¿ç”¨æŒ‡å—](USAGE.md) - å®Œæ•´çš„ä½¿ç”¨æ–‡æ¡£
- [å¿«é€Ÿå…¥é—¨](QUICKSTART.md) - 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

## âœ… å®Œæˆæ¸…å•

- [x] CI å·¥ä½œæµæ·»åŠ å¯†é’¥ç”Ÿæˆæ­¥éª¤
- [x] Release å·¥ä½œæµæ·»åŠ å¯†é’¥ç”Ÿæˆæ­¥éª¤
- [x] å‘å¸ƒåŒ…åŒ…å« scripts ç›®å½•
- [x] æ›´æ–°å‘å¸ƒè¯´æ˜
- [x] ç§»é™¤è¿‡æ—¶çš„ CLI å‘½ä»¤è¯´æ˜
- [x] æ·»åŠ æ–°çš„ä½¿ç”¨æµç¨‹è¯´æ˜
- [x] å¼ºè°ƒå¯†é’¥å®‰å…¨æ³¨æ„äº‹é¡¹

---

**æ›´æ–°å®Œæˆæ—¶é—´**: 2026-02-25  
**æ›´æ–°èŒƒå›´**: GitHub Actions é…ç½®  
**æ›´æ–°çŠ¶æ€**: âœ… å®Œæˆ  
**æµ‹è¯•çŠ¶æ€**: å¾…éªŒè¯
